version: 2.1

executors:
  default:
    docker:
      - image: ubuntu:16.04

jobs:
  build:
    description: "Check Ansible Syntax"
    executor: default
    steps:
      - run: 
          name: Install Ansible & Dependencies
          command: |
            apt-get update
            apt-get install -y software-properties-common python-apt python3-pip libssl-dev
            update-alternatives --install /usr/bin/python python /usr/bin/python3.5 2
            update-alternatives  --set python /usr/bin/python3.5
            pip3 install ansible
      - checkout
      - run: 
          name: Check Ansible Syntax
          command: ansible-playbook -i '127.0.0.1,' ansible/prod.yml --syntax-check
# It would be nice to run the following command, but requires some work to make
# --check actually run successfully (i.e. ensure apt repos are actually installed)
# - run: ansible-playbook -i '127.0.0.1,' ansible/prod.yml --connection=local -e 'cert_names=DNS:test.domino.com' --check
